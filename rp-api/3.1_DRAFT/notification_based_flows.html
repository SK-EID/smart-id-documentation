<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Notification based flows :: RP API integration guidance</title>
    <link rel="canonical" href="https://sk-eid.github.io/smart-id-documentation/rp-api/3.1_DRAFT/notification_based_flows.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/tabs.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item logo" href="https://www.skidsolutions.eu/"><svg viewBox="0 0 250 59.99"><defs><style>.sk-logo{fill:#fff;}</style></defs><g><g><path class="sk-logo" d="M30,0A30,30,0,1,0,60,30,30,30,0,0,0,30,0m0,56.56A26.57,26.57,0,1,1,56.56,30,26.56,26.56,0,0,1,30,56.56m-5.89-29a5.89,5.89,0,0,1,4.68,5.93,8.52,8.52,0,0,1-.17,1.63c-.84,3.68-4.1,5.32-7.44,5.32a13.51,13.51,0,0,1-1.5-.09c-2.32-.3-6.76-2.49-6.76-5.48a2.75,2.75,0,0,1,.27-1.17,1.87,1.87,0,0,1,1.71-1.1c1.21,0,1.93,1.13,2.6,2a3.14,3.14,0,0,0,1,.78,4.65,4.65,0,0,0,2,.69l.56,0h.35c1.41,0,3.14-.72,3.14-2.48a1.6,1.6,0,0,0-.72-1.47,2.82,2.82,0,0,0-.92-.38l-.79-.22-2.69-.65-.75-.19c-3.1-.89-5.09-2.73-5.09-5.69a6.92,6.92,0,0,1,.3-2,5.91,5.91,0,0,1,2.48-3.32,8,8,0,0,1,4.48-1.25h.55a6.44,6.44,0,0,1,1,.11,7.15,7.15,0,0,1,2.21.62,8.24,8.24,0,0,1,1.79,1c1.14.92,2.34,2.13,1.39,3.77a2,2,0,0,1-1.37,1,2.08,2.08,0,0,1-1.52-.32l-.72-.6-.43-.32a4.39,4.39,0,0,0-3-1c-1,0-2.4.3-2.75,1.45a2,2,0,0,0-.1.56c0,.48.29,1.15,2.05,1.68l.55.16.38.1.84.21,1.17.3.5.07.81.22M46.68,37a2.42,2.42,0,0,1,.4,1.29,2.17,2.17,0,0,1-1.46,2.1,3.51,3.51,0,0,1-.65.09,2.35,2.35,0,0,1-1.72-.8l-6.71-7.15v5.31c0,1.22-.45,2.7-2,2.7a2.18,2.18,0,0,1-2.13-2.36v-17c0-1.27.49-2.73,2.09-2.73a1.94,1.94,0,0,1,2.09,1.83V26l6.13-6.48a2.93,2.93,0,0,1,1.43-.89,2.07,2.07,0,0,1,2.32,1.62,2.57,2.57,0,0,1-.84,2.45l-6.36,6.51,7,7.22Zm25.49,2.71c0,.45-.12.64-.57.64H69.65c-.41,0-.57-.19-.57-.64V19.34c0-.44.16-.63.57-.63H71.6c.45,0,.57.19.57.63Zm5.74.64c-.38,0-.51-.22-.51-.64V19.34c0-.44.16-.63.58-.63h6.66c5.46,0,7.27,2.29,7.27,4.91V35.48c0,2.61-1.81,4.91-7.27,4.91Zm2.59-19V37.74h4.14c2.87,0,4.15-1.05,4.15-2.77V24.13c0-1.73-1.28-2.78-4.15-2.78Zm34.92,1.79c0-1.91-1-3.25-4.75-3.25s-4.76,1.34-4.76,3.25v1.18a2.84,2.84,0,0,0,2,2.71l6.13,2.33c1.59.6,3.19,1.81,3.19,4v2.81c0,2.49-1.53,4.5-6.61,4.5s-6.63-2-6.63-4.5V34.49c0-.29.13-.41.38-.41h.93c.25,0,.38.12.38.41V36c0,1.91,1.18,3.25,4.91,3.25s5-1.34,5-3.25V33.69c0-1.72-1.41-2.48-2.65-3L107,28.43a4.07,4.07,0,0,1-2.74-3.76V23c0-2.49,1.4-4.5,6.41-4.5s6.41,2,6.41,4.5v1.56c0,.25-.1.38-.39.38h-.92c-.26,0-.35-.13-.35-.38Zm6.82-.19c0-2.49,1.53-4.5,6.64-4.5s6.69,2,6.69,4.5v13.2c0,2.49-1.56,4.5-6.69,4.5s-6.64-2-6.64-4.5Zm11.61.25c0-1.94-1.24-3.28-5-3.28s-4.95,1.34-4.95,3.28V35.89c0,2,1.25,3.29,4.95,3.29s5-1.34,5-3.29ZM143,38.92h9.44c.26,0,.39.1.39.39V40c0,.29-.13.38-.39.38H141.63c-.19,0-.32-.13-.32-.38V19.09a.34.34,0,0,1,.39-.39h1c.26,0,.35.13.35.39Zm15.57-3c0,2,1.24,3.29,5,3.29s5-1.34,5-3.29V19.09a.33.33,0,0,1,.38-.38h1c.25,0,.35.12.35.38V36.15c0,2.49-1.53,4.5-6.67,4.5s-6.66-2-6.66-4.5V19.09a.33.33,0,0,1,.38-.38h1c.25,0,.35.12.35.38Zm28.8-17.18c.25,0,.38.09.38.38v.7c0,.29-.13.38-.38.38h-5.81V40c0,.25-.09.38-.35.38h-1c-.28,0-.38-.13-.38-.38V20.17H174.1c-.29,0-.38-.09-.38-.38v-.7c0-.29.09-.38.38-.38ZM193.14,40c0,.25-.1.38-.35.38h-1a.34.34,0,0,1-.38-.38V19.09a.33.33,0,0,1,.38-.38h1c.25,0,.35.12.35.38ZM198.91,23c0-2.49,1.53-4.5,6.63-4.5s6.7,2,6.7,4.5v13.2c0,2.49-1.56,4.5-6.7,4.5s-6.63-2-6.63-4.5Zm11.61.25c0-1.94-1.25-3.28-5-3.28s-4.94,1.34-4.94,3.28V35.89c0,2,1.24,3.29,4.94,3.29s5-1.34,5-3.29ZM231.28,40c0,.25-.1.38-.35.38h-.86a.33.33,0,0,1-.35-.19L220.6,24a17.53,17.53,0,0,1-1-1.92V40c0,.25-.1.38-.35.38h-.87A.34.34,0,0,1,218,40V19.09a.33.33,0,0,1,.38-.38h.87a.35.35,0,0,1,.31.15l9.22,16.36c.29.52.93,1.82.93,1.82V19.09a.33.33,0,0,1,.38-.38h.86c.25,0,.35.12.35.38Zm16.9-16.87c0-1.91-1.05-3.25-4.75-3.25s-4.75,1.34-4.75,3.25v1.18a2.84,2.84,0,0,0,2,2.71l6.12,2.33c1.6.6,3.19,1.81,3.19,4v2.81c0,2.49-1.53,4.5-6.6,4.5s-6.63-2-6.63-4.5V34.49c0-.29.12-.41.38-.41h.92c.26,0,.39.12.39.41V36c0,1.91,1.18,3.25,4.91,3.25s5-1.34,5-3.25V33.69c0-1.72-1.4-2.48-2.64-3l-5.94-2.3A4.09,4.09,0,0,1,237,24.67V23c0-2.49,1.4-4.5,6.41-4.5s6.41,2,6.41,4.5v1.56c0,.25-.09.38-.38.38h-.93c-.25,0-.35-.13-.35-.38Z"></path></g></g></svg></a>
      <a class="navbar-item" href="https://sk-eid.github.io/smart-id-documentation">RP API integration guidance</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rp-api" data-version="3.1_DRAFT">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="introduction.html">RP API documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="glossary.html">Terms and glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="changes.html">Changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="getting_started.html">Getting started with RP API v3</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="device_link_flows.html">Device link flows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="authcode.html"><code>authCode</code> calculation</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="notification_based_flows.html">Notification based flows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="api_specification.html">OpenAPI specification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="api_details.html">RP API details</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="interactions.html">Interactions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="signature_protocols.html">Signature protocols</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="response_verification.html">Response verification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secure.html">Secure Implementation Guide</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RP API documentation</span>
    <span class="version">3.1_DRAFT</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="introduction.html">RP API documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="introduction.html">3.1_DRAFT</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="introduction.html">RP API documentation</a></li>
    <li><a href="getting_started.html">Getting started with RP API v3</a></li>
    <li><a href="notification_based_flows.html">Notification based flows</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Notification based flows</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
TODO: Describe the notification based flow and when and how to use it. Work in progress.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In general, notification based flows are similar to the flows from RP API v2 in the sense that they rely on the push notifications mechanism. The main differences with regard to RP API v2 are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For signature requests, verification codes are returned to the RP from server, not calculated by the RP;</p>
</li>
<li>
<p>There are changes to the <a href="signature_protocols.html" class="xref page">signature protocols</a> of authentication and signature requests.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
TODO: Should we add anything else to the list here?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Below, sequence diagrams are given along with explanations of the differences.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_flow_diagrams"><a class="anchor" href="#_flow_diagrams"></a>Flow diagrams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following diagram describes the notification based flow for the authentication session.</p>
</div>
<div class="imageblock sequence kroki-format-svg kroki">
<div class="content">
<a class="image" href="_images/flow-768f84b044e39544b25820cdde678a84e6810e51.svg"><img src="_images/flow-768f84b044e39544b25820cdde678a84e6810e51.svg" alt="flow"></a>
</div>
</div>
<div class="paragraph">
<p>The following sequence diagram illustrates the notification based signing flow.</p>
</div>
<div class="imageblock sequence kroki-format-svg kroki">
<div class="content">
<a class="image" href="_images/flow-6842af68280039e2fce45759dcff39f4a477b163.svg"><img src="_images/flow-6842af68280039e2fce45759dcff39f4a477b163.svg" alt="flow"></a>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_signature_protocols"><a class="anchor" href="#_signature_protocols"></a>Signature protocols</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are separate signing protocols for authentication and signature requests (see <a href="signature_protocols.html" class="xref page">signature protocols</a> for details).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="verification_codes_for_authentication_requests"><a class="anchor" href="#verification_codes_for_authentication_requests"></a>Verification codes for authentication requests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In RP API v3 notification based authentication requests, RP must compute verification codes (VC) for each authentication request, so the user can bind together the session on the browser or RP app and the authentication request on the Smart-ID app.
The VC is computed as follows:</p>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">integer(SHA-256(rpChallenge)[-2:-1]) mod 10000</code></pre>
</div>
</div>
<div id="_tabs_1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_java" class="tab">
<p>Java</p>
</li>
<li id="_tabs_1_php" class="tab">
<p>PHP</p>
</li>
<li id="_tabs_1_python" class="tab">
<p>Python</p>
</li>
<li id="_tabs_1_go" class="tab">
<p>Go</p>
</li>
<li id="_tabs_1_rust" class="tab">
<p>Rust</p>
</li>
<li id="_tabs_1_kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="_tabs_1_c" class="tab">
<p>C#</p>
</li>
<li id="_tabs_1_node_js" class="tab">
<p>Node.js</p>
</li>
<li id="_tabs_1_ruby" class="tab">
<p>Ruby</p>
</li>
</ul>
</div>
<div id="_tabs_1_java--panel" class="tabpanel" aria-labelledby="_tabs_1_java">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.math.BigInteger;
import java.nio.charset.StandardCharsets;
import java.security.MessageDigest;
import java.util.Base64;

public class NotificationVerificationCode {

    public static void main(String[] args) throws Exception {

        String rpChallengeBase64 = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==";
        byte[] rpChallengeBytes = Base64.getDecoder().decode(
            rpChallengeBase64
        );

        MessageDigest md = MessageDigest.getInstance("SHA-256");
        md.update(rpChallengeBytes);
        byte[] sha256Hash = md.digest();

        BigInteger LAST_2_BYTES_BITMASK = new BigInteger("65535");

        BigInteger result = new BigInteger(sha256Hash)
            .and(LAST_2_BYTES_BITMASK)
            .mod(new BigInteger(10000));

        String verificationCode = String.format("%04d", result);

        System.out.println(verificationCode);
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_php--panel" class="tabpanel" aria-labelledby="_tabs_1_php">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">&lt;?php

$rpChallengeBase64 = base64_decode('GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==');
$sha256Hash = hash('sha256', $rpChallengeBase64, true);
$result = hexdec(bin2hex(substr($sha256Hash, -2))) % 10000;
$verificationCode = sprintf('%04d', $result);
echo $verificationCode;

?&gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_python--panel" class="tabpanel" aria-labelledby="_tabs_1_python">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import base64
import hashlib

rp_challenge_base64 = b"GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg=="
rp_challenge_bytes = base64.b64decode(rp_challenge_base64)
sha256_hash = hashlib.sha256(rp_challenge_bytes).digest()

result = int.from_bytes(sha256_hash[-2:], byteorder='big') % 10000
verification_code = f"{result:04d}"
print(verification_code)</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_go--panel" class="tabpanel" aria-labelledby="_tabs_1_go">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">package main

import (
	"crypto/sha256"
	"encoding/base64"
	"fmt"
)

func main() {
	var rpChallengeBase64 string = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg=="
	var rpChallengeBytes, err = base64.StdEncoding.DecodeString(rpChallengeBase64)
	if err != nil {
		panic(err)
	}

	var sha256Hash [32]byte = sha256.Sum256(rpChallengeBytes)
	var result int = int(sha256Hash[len(sha256Hash)-2])&lt;&lt;8 + int(sha256Hash[len(sha256Hash)-1])
	result %= 10000

	var verificationCode string = fmt.Sprintf("%04d", result)
	fmt.Printf("%s\n",verificationCode)
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_rust--panel" class="tabpanel" aria-labelledby="_tabs_1_rust">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use base64::decode;
use sha2::{Sha256, Digest};

fn main() {
    let rp_challenge_base64: &amp;str = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==";
    let rp_challenge_bytes = decode(rp_challenge_base64).unwrap();
    let sha256_hash = Sha256::digest(&amp;rp_challenge_bytes);
    let result = (((sha256_hash[30] as u16) &lt;&lt; 8) + (sha256_hash[31] as u16)) % 10000;
    let verification_code: String = format!("{:04}", result);
    println!("{}", verification_code);
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_kotlin--panel" class="tabpanel" aria-labelledby="_tabs_1_kotlin">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import java.math.BigInteger
import java.nio.charset.StandardCharsets
import java.security.MessageDigest
import java.util.Base64

fun main() {
    val rpChallengeBase64: String = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg=="
    val rpChallengeBytes: ByteArray = Base64.getDecoder().decode(rpChallengeBase64)

    val sha256Hash: ByteArray = MessageDigest
        .getInstance("SHA-256")
        .digest(rpChallengeBytes)

    val LAST_2_BYTES_BITMASK: BigInteger = BigInteger("65535")

    val result: BigInteger = BigInteger(sha256Hash)
        .and(LAST_2_BYTES_BITMASK)
        .mod(BigInteger("10000"))

    val verificationCode = "%04d".format(result)

    println(verificationCode)
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_c--panel" class="tabpanel" aria-labelledby="_tabs_1_c">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cs hljs" data-lang="cs">using System;
using System.Security.Cryptography;

public class NotificationVerificationCode
{
    public static void Main(string[] args)
    {
        string rpChallengeBase64 = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==";
        byte[] rpChallengeBytes = Convert.FromBase64String(rpChallengeBase64);

        using (SHA256 sha256 = SHA256.Create())
        {
            byte[] sha256Hash = sha256.ComputeHash(rpChallengeBytes);
            int result = ((sha256Hash[30] &lt;&lt; 8) + (sha256Hash[31])) % 10000;
            string verificationCode = result.ToString("D4");
            Console.WriteLine(verificationCode);
        }
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_node_js--panel" class="tabpanel" aria-labelledby="_tabs_1_node_js">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const crypto = require('crypto');

const rpChallenge = Buffer.from('GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==', 'base64');

const sha256 = crypto.createHash('sha256');
sha256.update(rpChallenge);
const sha256Hash = sha256.digest();

const result = sha256Hash.readUInt16BE(30) % 10000
  .toString()
  .padStart(4, '0');

console.log(result);</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_ruby--panel" class="tabpanel" aria-labelledby="_tabs_1_ruby">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ruby hljs" data-lang="ruby">require 'base64'
require 'digest'

rp_challenge = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg=="
sha256_hash = Digest::SHA256.digest(Base64.decode64(rp_challenge))

last_2_bytes = sha256_hash[-2..-1].unpack('n*').first

result = (last_2_bytes % 10_000).to_s.rjust(4, '0')

puts result</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 1. Verification code</div>
<div class="content">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">7180</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Calculate <code>SHA-256</code> from the <code>rpChallenge</code>, extract 2 rightmost bytes from the result, interpret them as a big-endian unsigned integer and take the last 4 digits in decimal form for display. <code>SHA-256</code> must be used to calculate the VC.</p>
</div>
<div class="paragraph">
<p>Please keep in mind that the rpChallenge is the real rpChallenge byte value (for example, the byte array returned from the <code>SecureRandom()</code> or equivalent method), not the Base64 encoded form used for transport or the popular hexadecimal representation.</p>
</div>
<div class="paragraph">
<p>The VC value must be displayed to the user in the browser together with a message asking the end user to verify the code matches with the one displayed on their mobile device. The user must not proceed if these don&#8217;t match.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="verification_codes_for_signature_requests"><a class="anchor" href="#verification_codes_for_signature_requests"></a>Verification codes for signature requests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In RP API v3 notification based signature requests, verification codes (VC) are not generated by RP based on the DTBS (data-to-be-signed), but are returned from the server to RP. Verification codes are only relevant for the notification based flows.</p>
</div>
<div class="paragraph">
<p>Currently, there is only one supported verification code type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>alphaNumeric4</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The returned verification code consists of 4 characters. It must be shown to the user as it is received from the server. Note that the type is "alphaNumeric4" and this refers to the fact that in the future the 4-symbol code might also contain letters. For the time being, only numeric values are returned for technical reasons. This may change in the future, so RPs should make no assumptions about it containing numeric data only!</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Motivation for adding non-numeric data in future: In the previous API versions the numeric only codes were similar to the users' PIN codes and caused confusion for some of the users. The inclusion of letters also improves the total number of possible combinations, thus strengthening it as a security measure.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>© 2024 SK ID Solutions AS</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/tabs.js" data-sync-storage-key="language"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
