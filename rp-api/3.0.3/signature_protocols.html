<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Signature protocols :: Smart-ID documentation</title>
    <link rel="canonical" href="https://sk-eid.github.io/smart-id-documentation/rp-api/signature_protocols.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../_/css/site.css">

<link rel="icon" href="../../_/img/favicon.svg" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://sk-eid.github.io/smart-id-documentation">
        <img src="../../_/img/sk-id-solutions.svg" class="logo" />
      </a>
      <span class="separator"></span>
      <span class="title">Smart-ID documentation</span>
    </div>

    <div class="navbar-right">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="nav-toggle"></button>    </div>

  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rp-api" data-version="3.0.3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="introduction.html">RP API documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="glossary.html">Terms and glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="changes.html">Changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sessions.html">Session types</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authentication_session.html"><code>authentication</code> session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="signature_session.html"><code>signature</code> session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="certificatechoice_session.html"><code>certificatechoice</code> session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="session_status.html"><code>session</code> status</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dynamic_link_flows.html">Dynamic link flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="notification_based_flows.html">Notification based flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="response_verification.html">Response verification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="object_references.html">REST object references</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="signature_protocols.html">Signature protocols</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interactions.html">Interactions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="request_properties.html">Additional request properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="api_details.html">REST API details</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secure.html">Secure Implementation Guide</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Relying Party API</span>
    <span class="version">3.0.3</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../index.html">Documentation</a></div>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../introduction.html">Relying Party API</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../introduction.html">3.1.4</a>
        </li>
        <li class="version">
          <a href="../3.1.3/introduction.html">3.1.3</a>
        </li>
        <li class="version is-current">
          <a href="introduction.html">3.0.3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Signature protocols</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The RP API&#8217;s main use case is to provide digital signatures which is enabled by use of signature protocols.</p>
</div>
<div class="paragraph">
<p>The signature protocol <code>ACSP_V1</code> is used for authentication requests and <code>RAW_DIGEST_SIGNATURE</code> signature protocol for signing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="acsp_v1"><a class="anchor" href="#acsp_v1"></a><code>ACSP_V1</code> signature protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authentication Context Signature Protocol version 1 makes the signature non-replayable by adding a server-side component to the signed object.</p>
</div>
<div class="paragraph">
<p>The RP must provide the digest algorithm to use as well a challenge it needs signed. The challenge must be generated anew for every single authentication request.</p>
</div>
<div class="paragraph">
<p>It must be remembered by the RP for the duration of the <code>authentication</code> session, and later it is used to reconstruct and validate the signed authentication data structure.</p>
</div>
<div class="paragraph">
<p>The recommended way of generating the challenge this is to use the Java SecureRandom class<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> or equivalent method in other programming languages, to generate a random value for each new authentication request.</p>
</div>
<div class="paragraph">
<p>The value of the <code>randomChallenge</code> must be kept in the current user&#8217;s session on the backend for later use in response validation.</p>
</div>
<table id="acsp_v1_param" class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Signature protocol parameters for authentication request with signature protocol ACSP_V1</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>randomChallenge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A random value which is calculated by generating random bits with size in the range of 32 bytes &#8230;&#8203; 64 bytes and applying Base64 encoding (according to rfc4648). It is generated per each <code>authentication</code> session in the RP backend. See above for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signatureAlgorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digital signature algorithm name. See <a href="#supported_signature_algorithms">here for supported signature algorithms</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table describes the signature body for <code>ACSP_V1</code> protocol that the RP will receive in the session response.</p>
</div>
<div class="paragraph">
<p>Notice that the actual object that was signed is not present&#8201;&#8212;&#8201;it needs to be compiled by the RP using the previously sent <code>randomChallenge</code> and the <code>serverRandom</code> returned in this response. This re-constructed object is then used to validate the signature.</p>
</div>
<table class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Signature body for ACSP_V1 in session response</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 15.3846%;">
<col style="width: 7.6923%;">
<col style="width: 61.5385%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature value, base64 encoded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serverRandom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A random value of 24 or more characters from Base64 alphabet, which is generated at RP API service side. RP must validate that the value contains only valid Base64 characters, and that the length is not less than 24 characters. This value will be returned from RP API and RelyingParties must use it exactly as it was returned during the validation of signature. There are not any guarantees that the returned value length is the same in each call of the RP API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signatureAlgorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digital signature algorithm name. This is a reference name to algorithm defined in some Public-Key cryptography standards. See <a href="#supported_signature_algorithms">here for supported signature algorithms</a>.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">ACSP_V1 signature sample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "signatureProtocol": "ACSP_V1",
  "signature": {
    "value": "B+A9CfjIBZnDHHav3B4F...",
    "serverRandom": "B+C9XVjIAZnCHH9vfBSv...",
    "signatureAlgorithm": "sha512WithRSAEncryption"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the <code>signature.value</code> the RP client must reconstruct its input digest (hash) and calculate it themselves. The digest is calculated over the concatenation of the <code>signatureProtocol</code>, the Base64 encoded <code>serverRandom</code> and the Base64 encoded <code>randomChallenge</code> separated by semicolons:</p>
</div>
<div class="paragraph">
<p><code>digest(signatureProtocol + ";" + serverRandom +  ";" + randomChallenge)</code></p>
</div>
<div class="paragraph">
<p>Note that <code>signature.serverRandom</code> in the response and the <code>randomChallenge</code> in the initial request are already Base64 encoded.</p>
</div>
<div class="paragraph">
<p>The signature algorithm that was used to generate the signature based on the digest is specified in <code>signature.signatureAlgorithm</code>.</p>
</div>
<div class="paragraph">
<p>Full verification of the signature and response is described in <a href="response_verification.html" class="xref page">Response verification</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="raw_digest_signature"><a class="anchor" href="#raw_digest_signature"></a><code>RAW_DIGEST_SIGNATURE</code> signature protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>RAW_DIGEST_SIGNATURE</code> signature protocol allows direct signing of the digest that is requested by the RP.</p>
</div>
<div class="paragraph">
<p>The RP must provide the digest algorithm to use as well the digest hash that is being signed. In case an electronic signature is being created this is calculated from the electronic signature container.</p>
</div>
<table id="raw_digest_signature_param" class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Signature protocol parameters for signing request with signature protocol RAW_DIGEST_SIGNATURE</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 15.3846%;">
<col style="width: 7.6923%;">
<col style="width: 61.5385%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>digest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64 encoded digest to be signed (<a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signatureAlgorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digital signature algorithm name. This is a reference name to algorithm defined in some Public-Key cryptography standards. See <a href="#supported_signature_algorithms">here for supported signature algorithms</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table describes the signature body for the <code>RAW_DIGEST_SIGNATURE</code> protocol that the RP will receive in the session response.</p>
</div>
<table class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Signature body for RAW_DIGEST_SIGNATURE in session response</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 15.3846%;">
<col style="width: 7.6923%;">
<col style="width: 61.5385%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature value, base64 encoded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signatureAlgorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digital signature algorithm name. This is a reference name to algorithm defined in some Public-Key cryptography standards. See <a href="#supported_signature_algorithms">here for supported signature algorithms</a>.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">RAW_DIGEST_SIGNATURE signature</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "signatureProtocol": "RAW_DIGEST_SIGNATURE",
  "signature": {
    "value": "B+A9CfjIBZnDHHav3B4F...",
    "signatureAlgorithm": "sha512WithRSAEncryption"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="supported_signature_algorithms"><a class="anchor" href="#supported_signature_algorithms"></a>Supported signature algorithms</h2>
<div class="sectionbody">
<table class="tableblock frame-none grid-none stripes-odd stretch">
<caption class="title">Supported signature algorithms</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Algorithm</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sha256WithRSAEncryption</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Hash Algorithm 256 (SHA-256) with Rivest, Shamir and Adleman (RSA) encryption <a href="https://www.rfc-editor.org/rfc/rfc8017#appendix-A.2.4">RFC8017, Appendix A.2.4</a>, OID <a href="https://oidref.com/1.2.840.113549.1.1.11">1.2.840.113549.1.1.11</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sha384WithRSAEncryption</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Hash Algorithm 384 (SHA-384) with Rivest, Shamir and Adleman (RSA) Encryption <a href="https://www.rfc-editor.org/rfc/rfc8017#appendix-A.2.4">RFC8017, Appendix A.2.4</a>, OID <a href="https://oidref.com/1.2.840.113549.1.1.12">1.2.840.113549.1.1.12</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sha512WithRSAEncryption</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Hash Algorithm 512 (SHA-512) with Rivest, Shamir and Adleman (RSA) encryption <a href="https://www.rfc-editor.org/rfc/rfc8017#appendix-A.2.4">RFC8017, Appendix A.2.4</a>, OID <a href="https://oidref.com/1.2.840.113549.1.1.13">1.2.840.113549.1.1.13</a>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="hash_algorithms"><a class="anchor" href="#hash_algorithms"></a>Hash algorithms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Smart-ID supports signature operations based on algorithms from the SHA-2 family (<code>SHA-256</code>, <code>SHA-384</code> and <code>SHA-512</code>). This information is expressed via the <code>signatureAlgorithm</code> parameter.</p>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. See <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/SecureRandom.html" class="bare">https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/SecureRandom.html</a>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>© 2024 SK ID Solutions AS</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/tabs.js" data-sync-storage-key="language"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
