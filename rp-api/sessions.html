<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Session types :: RP API integration guidance</title>
    <link rel="canonical" href="https://www.example.com/rp-api/sessions.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/css/vendor/tabs.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.example.com">RP API integration guidance</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rp-api" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="introduction.html">RP API documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="glossary.html">Terms and glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="changes.html">Changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="sessions.html">Session types</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authentication_session.html"><code>authentication</code> session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="signature_session.html"><code>signature</code> session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="certificatechoice_session.html"><code>certificatechoice</code> session</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="session_status.html"><code>session</code> status</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dynamic_link_flows.html">Dynamic link flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="notification_based_flows.html">Notification based flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="response_verification.html">Response verification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="object_references.html">REST object references</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="signature_protocols.html">Signature protocols</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interactions.html">Interactions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="request_properties.html">Additional request properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="api_details.html">REST API details</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="secure.html">Secure Implementation Guide</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RP API documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="introduction.html">RP API documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="introduction.html">master</a>
        </li>
        <li class="version">
          <a href="3.0.3/introduction.html">3.0.3</a>
        </li>
        <li class="version">
          <a href="3.0.2/introduction.html">3.0.2</a>
        </li>
        <li class="version">
          <a href="3.0.1/introduction.html">3.0.1</a>
        </li>
        <li class="version">
          <a href="3.0.0/introduction.html">3.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="introduction.html">RP API documentation</a></li>
    <li><a href="sessions.html">Session types</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">master</button>
  <div class="version-menu">
    <a class="version is-current" href="sessions.html">master</a>
    <a class="version" href="3.0.3/sessions.html">3.0.3</a>
    <a class="version" href="3.0.2/sessions.html">3.0.2</a>
    <a class="version" href="3.0.1/sessions.html">3.0.1</a>
    <a class="version" href="3.0.0/sessions.html">3.0.0</a>
  </div>
</div>
<div class="edit-this-page"><a href="file:///antora/RP_API_documentation/modules/ROOT/pages/sessions.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Session types</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The API provides four different types of endpoints. The first three are <code>POST</code> requests that return a <code>sessionID</code> and the fourth is a <code>GET</code> used to query for the result based on the <code>sessionID</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="authentication_session.html" class="xref page"><code>authentication</code> session</a> is used to log a user onto a system or otherwise verify the identity of a user;</p>
</li>
<li>
<p>the <a href="signature_session.html" class="xref page"><code>signature</code> session</a> is used to create digital signature;</p>
</li>
<li>
<p>the <a href="certificatechoice_session.html" class="xref page"><code>certificatechoice</code> session</a> is used immediately prior to the <code>signature</code> session when the user&#8217;s signing certificate is required to create the object that will be signed;</p>
</li>
<li>
<p>finally, the <a href="session_status.html" class="xref page"><code>session</code> status endpoint</a> provides the result of the above sessions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Their implementation details are described in their respective subpages.</p>
</div>
<div class="paragraph">
<p>There are two types of flows that can be used in each of the three sessions - the <a href="notification_based_flows.html" class="xref page">notification based flow</a> and the <a href="dynamic_link_flows.html" class="xref page">dynamic link based flow</a>.</p>
</div>
<div class="paragraph">
<p>There are different ways to reference users - via their issued identifier, a document number linking a specific account or even not at all (in case of dynamic link based flows). The different object references are described on a <a href="object_references.html" class="xref page">dedicated page</a>.</p>
</div>
<div class="paragraph">
<p>The main use cases and which sessions and flows to use are described below. Utilizing the RP API as described below provides the best user experience and security.</p>
</div>
<div class="paragraph">
<p>In the URL examples below and other pages <code>BASE</code> refers to the RP API base address <code>https://rp-api.example.com</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multi_device_use_cases"><a class="anchor" href="#_multi_device_use_cases"></a>Multi-device use cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Use case:</strong> The RP session is on a separate device from the mobile phone where the Smart-ID app is installed.</p>
</div>
<div class="paragraph">
<p>For example, the user is using a PC browser to access an RP website or a tablet to access an RP application.</p>
</div>
<div class="sect2">
<h3 id="_authentication"><a class="anchor" href="#_authentication"></a>Authentication</h3>
<div class="paragraph">
<p>Using the dynamic link based flow with QR codes is the most secure:</p>
</div>
<div class="paragraph">
<p>RP calls the anonymous dynamic link based <code>authentication</code> session endpoint and displays a QR code that the user must scan with the Smart-ID app.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/authentication/dynamic-link/anonymous</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Instead of using the anonymous <code>authentication</code> session endpoint, the RP can request the user to enter their user identifier and utilize the non-anonymous <code>authentication</code> session endpoint. This may be beneficial when the RP utilizes custom usernames.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/authentication/dynamic-link/private/:issuer/:encoded-identifier</code></p>
</li>
<li>
<p><code>BASE/v3/authentication/dynamic-link/etsi/:id-etsi-qcs-SemanticsId-Natural</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notification based <code>authentication</code> session endpoint can also be used for the same purpose.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to improve security and prevent phishing attacks, it is recommended to only allow notification based flows on devices and browsers that have successfully completed a dynamic link based flow. Setting up a unique device identifier is left to the RP to implement.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using a notification based <code>authentication</code> session endpoint triggers a push notification to all the user&#8217;s devices instead of the user having to scan QR codes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/authentication/notification/private/:issuer/:encoded-identifier</code></p>
</li>
<li>
<p><code>BASE/v3/authentication/notification/etsi/:id-etsi-qcs-SemanticsId-Natural</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_signing_with_prior_authentication"><a class="anchor" href="#_signing_with_prior_authentication"></a>Signing with prior authentication</h3>
<div class="sect3">
<h4 id="_without_certificate_query"><a class="anchor" href="#_without_certificate_query"></a>Without certificate query</h4>
<div class="paragraph">
<p>If a user has already logged onto the RP app or website using Smart-ID authentication, the RP can call the notification based <code>signature</code> session endpoint to sign using the same Smart-ID account that was used for authentication.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to improve security and prevent phishing attacks, it is recommended to only allow notification based flows on devices and browsers that have successfully completed a dynamic link based flow. Setting up a unique device identifier is left to the RP to implement.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The document number is attained from the preceding authentication call.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/signature/notification/document/:documentnumber</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_with_certificate_query"><a class="anchor" href="#_with_certificate_query"></a>With certificate query</h4>
<div class="paragraph">
<p>In many cases, the user&#8217;s signing certificate is required before the <code>signature</code> session can be initiated. Calling the notification based <code>certificatechoice</code> session endpoint allows obtaining it. As the document number is already known, no user interaction is required for the <code>certificatechoice</code> session and the RP API can immediately provide the certificate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/certificatechoice/notification/document/:documentnumber</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the signing certificate is obtained, the notification based <code>signature</code> session endpoint can be called with the document number.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/signature/notification/document/:documentnumber</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_signing_without_prior_authentication"><a class="anchor" href="#_signing_without_prior_authentication"></a>Signing without prior authentication</h3>
<div class="sect3">
<h4 id="_without_certificate_query_2"><a class="anchor" href="#_without_certificate_query_2"></a>Without certificate query</h4>
<div class="paragraph">
<p>In case no prior authentication has taken place, the dynamic link based <code>signature</code> session endpoint should be called.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/signature/dynamic-link/private/:issuer/:encoded-identifier</code></p>
</li>
<li>
<p><code>BASE/v3/signature/dynamic-link/etsi/:id-etsi-qcs-SemanticsId-Natural</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_with_certificate_query_2"><a class="anchor" href="#_with_certificate_query_2"></a>With certificate query</h4>
<div class="paragraph">
<p>Often though the certificate is required prior to the signing request.</p>
</div>
<div class="paragraph">
<p>It is recommended for the RP to first call the anonymous dynamic link based <code>certificatechoice</code> session endpoint on a new device for improved security and phishing-resistance.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/certificatechoice/dynamic-link/anonymous</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Immediately after that, RP should call the notification based <code>signature</code> session endpoint.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/signature/notification/document/:documentnumber</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The combination of dynamic link based <code>certificatechoice</code> and notification based <code>signature</code> session endpoints provides the optimal user experience where Smart-ID app is launched only once.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_single_device_use_cases"><a class="anchor" href="#_single_device_use_cases"></a>Single-device use cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Use case:</strong> The RP frontend (whether an RP app or website accessed by a mobile browser) resides on the same mobile device as the Smart-ID app.</p>
</div>
<div class="paragraph">
<p>The client is using a mobile app or RP detects that the user is on a mobile browser so it can be assumed that the user intends to use the Smart-ID app on the same device.</p>
</div>
<div class="paragraph">
<p>However, a fallback option should also be provided to switch to the separate device use case.</p>
</div>
<div class="sect2">
<h3 id="_authentication_2"><a class="anchor" href="#_authentication_2"></a>Authentication</h3>
<div class="paragraph">
<p>Use the anonymous dynamic link based <code>authentication</code> session endpoint for App2App and Web2App flows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/authentication/dynamic-link/anonymous</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, the non-anonymous flow can be used to too.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/authentication/dynamic-link/private/:issuer/:encoded-identifier</code></p>
</li>
<li>
<p><code>BASE/v3/authentication/dynamic-link/etsi/:id-etsi-qcs-SemanticsId-Natural</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a fallback (in case the Smart-ID app is on a separate account), RP should provide an option to use QR codes instead of the App2App or Web2App link. There is no need to query the RP API again for this.</p>
</div>
</div>
<div class="sect2">
<h3 id="_signing_with_prior_authentication_2"><a class="anchor" href="#_signing_with_prior_authentication_2"></a>Signing with prior authentication</h3>
<div class="sect3">
<h4 id="_without_certificate_query_3"><a class="anchor" href="#_without_certificate_query_3"></a>Without certificate query</h4>
<div class="paragraph">
<p>Call the dynamic link based <code>signature</code> session endpoint and provide the document number from the <code>authentication</code> session to ensure the same account is being used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/signature/dynamic-link/document/:documentnumber</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_with_certificate_query_3"><a class="anchor" href="#_with_certificate_query_3"></a>With certificate query</h4>
<div class="paragraph">
<p>As the document number is already known, no user interaction is required for the <code>certificatechoice</code> session and the RP API can immediately provide the certificate.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to improve security and prevent phishing attacks, it is recommended to only allow notification based flows on devices and browsers that have successfully completed a dynamic link based flow. Setting up a unique device identifier is left to the RP to implement.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/certificatechoice/notification/document/:documentnumber</code></p>
</li>
<li>
<p><code>BASE/v3/signature/dynamic-link/document/:documentnumber</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_signing_without_prior_authentication_2"><a class="anchor" href="#_signing_without_prior_authentication_2"></a>Signing without prior authentication</h3>
<div class="sect3">
<h4 id="_without_certificate_query_4"><a class="anchor" href="#_without_certificate_query_4"></a>Without certificate query</h4>
<div class="paragraph">
<p>In case no prior authentication has taken place, one should call the dynamic link based <code>signature</code> session endpoint.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/signature/dynamic-link/private/:issuer/:encoded-identifier</code></p>
</li>
<li>
<p><code>BASE/v3/signature/dynamic-link/etsi/:id-etsi-qcs-SemanticsId-Natural</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_with_certificate_query_4"><a class="anchor" href="#_with_certificate_query_4"></a>With certificate query</h4>
<div class="paragraph">
<p>Often though the certificate is required prior to the signing request. Call the anonymous dynamic link based <code>certificatechoice</code> session endpoint and then immediately the notification based <code>signature</code> session endpoint.</p>
</div>
<div class="paragraph">
<p>The Smart-ID app will wait for the <code>signature</code> session and return only after it has been completed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BASE/v3/certificatechoice/dynamic-link/anonymous</code></p>
</li>
<li>
<p><code>BASE/v3/signature/notification/document/:documentnumber</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script async src="../_/js/vendor/tabs.js" data-sync-storage-key="language"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async src="../search-index.js"></script>
  </body>
</html>
