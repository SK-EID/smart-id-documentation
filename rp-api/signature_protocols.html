<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Signature protocols :: Smart-ID documentation</title>
    <link rel="canonical" href="https://sk-eid.github.io/smart-id-documentation/rp-api/signature_protocols.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../_/css/site.css">

<link rel="icon" href="../_/img/favicon.svg" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://sk-eid.github.io/smart-id-documentation">
        <img src="../_/img/sk-id-solutions.svg" class="logo" />
      </a>
      <span class="separator"></span>
      <span class="title">Smart-ID documentation</span>
    </div>

    <div class="navbar-right">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="nav-toggle"></button>    </div>

  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rp-api" data-version="3.1.4">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="introduction.html">Relying Party API</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">Smart-ID Documentation</span>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Getting started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../demo.html">Try out</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementation.html">Smart-ID integration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../environments.html">Environments</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../device_link.html">Device-link fallback page</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../https_pinning.html">Implementing HTTPS pinning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../client_libraries.html">Client libraries</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../logos.html">Logos</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../test_accounts.html">Test accounts</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contact.html">Contact</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text">Relying Party API</span>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="changes.html">Changes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="device_link_flows.html">Device link flows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authcode.html"><code>authCode</code> calculation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="notification_based_flows.html">Notification based flows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="api_specification.html">OpenAPI specification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="api_details.html">API technical description</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="interactions.html">Interactions</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="signature_protocols.html">Signature protocols</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="callback_urls.html">Callback URLs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="response_verification.html">Response verification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="additional_security_measures.html">Additional security measures</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Relying Party API</span>
    <span class="version">3.1.4</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../index.html">Documentation</a></div>
    </li>
    <li class="component is-current">
      <div class="title"><a href="introduction.html">Relying Party API</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="introduction.html">3.1.4</a>
        </li>
        <li class="version">
          <a href="3.1.3/introduction.html">3.1.3</a>
        </li>
        <li class="version">
          <a href="3.0.3/introduction.html">3.0.3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Signature protocols</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The primary use case of RP API is to provide digital signatures. In RP API v3, new signature protocols for authentication and signing use cases have been introduced in order to maximize the security benefits for each use case:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#acsp_v2_signature_protocol">Signature protocol <code>ACSP_V2</code></a> - for authentication requests,</p>
</li>
<li>
<p><a href="#raw_digest_signature_protocol">Signature protocol <code>RAW_DIGEST_SIGNATURE</code></a> - for signing requests.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="acsp_v2_signature_protocol"><a class="anchor" href="#acsp_v2_signature_protocol"></a><code>ACSP_V2</code> signature protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authentication Context Signature Protocol (ACSP) is a protocol that is used for authentication requests. In <code>ACSP_v2</code>, the final data-to-be-signed object incorporates multiple factors such as a challenge from the Relying Party (rpChallenge), a server-provided random factor (serverRandom), and a random factor from the user&#8217;s mobile device (userChallenge).</p>
</div>
<div class="sect2">
<h3 id="acsp_v2_signature_request_parameters"><a class="anchor" href="#acsp_v2_signature_request_parameters"></a><code>ACSP_V2</code> signature request parameters</h3>
<div class="paragraph">
<p>For <code>ACSP_V2</code> <code>signatureProtocol</code> and <code>signatureProtocolParameters</code> parameters in the authentication requests and examples, select an authentication endpoint in <a href="api_specification.html#tag/authentication-session" class="xref page">OpenAPI specification</a>.</p>
</div>
<div class="sect3">
<h4 id="_rpchallenge_generation"><a class="anchor" href="#_rpchallenge_generation"></a><code>rpChallenge</code> generation</h4>
<div class="paragraph">
<p>Generation of <code>rpChallenge</code> can be done as follows:</p>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">rpChallenge := BASE64-ENCODE(CRYPTO-RANDOM(64))</code></pre>
</div>
</div>
<div id="_tabs_1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_java" class="tab">
<p>Java</p>
</li>
<li id="_tabs_1_php" class="tab">
<p>PHP</p>
</li>
<li id="_tabs_1_python" class="tab">
<p>Python</p>
</li>
<li id="_tabs_1_go" class="tab">
<p>Go</p>
</li>
<li id="_tabs_1_rust" class="tab">
<p>Rust</p>
</li>
<li id="_tabs_1_kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="_tabs_1_c" class="tab">
<p>C#</p>
</li>
<li id="_tabs_1_node_js" class="tab">
<p>Node.js</p>
</li>
<li id="_tabs_1_ruby" class="tab">
<p>Ruby</p>
</li>
</ul>
</div>
<div id="_tabs_1_java--panel" class="tabpanel" aria-labelledby="_tabs_1_java">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.security.SecureRandom;
import java.util.Base64;

public class RandomGenerateBase64Encode {
  public static void main(String[] args) {
    byte[] rpChallengeBytes = new byte[64];

    new SecureRandom().nextBytes(rpChallengeBytes);

    String rpChallenge = Base64.getEncoder()
      .encodeToString(rpChallengeBytes);

    System.out.println(rpChallenge);
  }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_php--panel" class="tabpanel" aria-labelledby="_tabs_1_php">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">&lt;?php

$rpChallengeBytes = random_bytes(64);
$rpChallenge = base64_encode($rpChallengeBytes);
echo $rpChallenge;

?&gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_python--panel" class="tabpanel" aria-labelledby="_tabs_1_python">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import os
import base64

rp_challenge_bytes = os.urandom(64)
rp_challenge = base64.b64encode(rp_challenge_bytes)
print(rp_challenge)</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_go--panel" class="tabpanel" aria-labelledby="_tabs_1_go">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">package main

import (
	"crypto/rand"
	"encoding/base64"
	"fmt"
)

func main() {
	var rpChallengeBytes []byte = make([]byte, 64)
	_, err := rand.Read(rpChallengeBytes)
	if err != nil {
		fmt.Printf("error: %s\n", err)
		return
	}
	var rpChallenge []byte = []byte(base64.StdEncoding.EncodeToString([]byte(rpChallengeBytes)))
	fmt.Printf("%q\n", rpChallenge)
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_rust--panel" class="tabpanel" aria-labelledby="_tabs_1_rust">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use base64::Engine as _;
use rand::RngCore;
use rand::rngs::OsRng;

fn main() {
    let mut rp_challenge_bytes: [u8; 64] = [0u8; 64];
    OsRng.fill_bytes(&amp;mut rp_challenge_bytes);
    let rp_challenge_string: String = base64::engine::general_purpose::STANDARD.encode(rp_challenge_bytes);
    let rp_challenge: &amp;[u8] = rp_challenge_string.as_bytes();
    println!("{:?}\n{}", rp_challenge, rp_challenge_string);
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_kotlin--panel" class="tabpanel" aria-labelledby="_tabs_1_kotlin">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import java.security.SecureRandom
import java.util.Base64

fun main() {
    val random = SecureRandom()
    val rpChallengeBytes: ByteArray = ByteArray(64)

    random.nextBytes(rpChallengeBytes)
    val rpChallenge: String = Base64.getEncoder()
      .encodeToString(rpChallengeBytes)

    println(rpChallenge)
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_c--panel" class="tabpanel" aria-labelledby="_tabs_1_c">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cs hljs" data-lang="cs">using System;

public class RandomGenerateBase64Encode
{
    public static void Main(string[] args)
    {
        byte[] rpChallengeBytes = new byte[64];
        new Random().NextBytes(rpChallengeBytes);
        string rpChallenge = Convert.ToBase64String(rpChallengeBytes);
        Console.WriteLine(rpChallenge);
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_node_js--panel" class="tabpanel" aria-labelledby="_tabs_1_node_js">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const crypto = require('crypto');

const rpChallengeBytes = crypto.randomBytes(64);
const rpChallenge = rpChallengeBytes.toString('base64');

console.log(rp_challenge);</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_ruby--panel" class="tabpanel" aria-labelledby="_tabs_1_ruby">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ruby hljs" data-lang="ruby">require 'base64'
require 'securerandom'

rp_challenge_bytes = SecureRandom.random_bytes(64)
rp_challenge = Base64.strict_encode64(rp_challenge_bytes)
puts rp_challenge</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_acsp_v2_signature_response_parameters"><a class="anchor" href="#_acsp_v2_signature_response_parameters"></a><code>ACSP_V2</code> signature response parameters</h3>
<div class="paragraph">
<p>For <code>ACSP_V2</code> <code>signature</code> parameter in the authentication response and examples, see <a href="api_specification.html#tag/session-endpoint/GET/v3/session/{sessionID}" class="xref page">GET /v3/session/{sessionID} in OpenAPI specification</a>. This is an example <code>ACSP_V2</code> signature object that is returned in the response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"signature": {
    "value": "Vak2Q0NiFnh6+lW+YaJuB8yMYM7k3I5QfsUxS3Y1Ddm3qy6HvebLl0/t17dq289/+4mGx45qnHVNj1CzqF88lYFpwAQXFc5XiHtYbvnENgjwLSfrQ9mrSt0phemAK29GzAexilPPy5+PdeCdO+TEuMIhi/qkKhL+lk5d1flmrWZQ4B0H7kXTqRjJvCAUc8bsdM7SLV5jZuEIhOqTCsyDY3FZmyJi4ms8SsOmYCy/Do20CIiQbv75eunKfTKciqVnOA+WYN5OXLJVqhgaHJ+hYiYA+QXOvIIYKVIUdB1rDRnKwwvZk1lZ3oKW1r7XGkovbmwRz+NpmHTyMUubXXQHYah3T4h7vf0C14MBpupWRB47s6rsdPZzH2No7AoDGjMGAMEWg5rdB45fYXbjRV2T69e4c47VpubG1DXTsoXowe/yzXdIjUYfZDwozzW6+IXTdAKL4LP6wmCU+PxP/GfYQ1k1w3fXjh4XeO9QmipRDEle2l0z6nYJaGuIYCb7pDh6ZoJllyKSmhqWG0PMLod34Lo1MMP4WGvLe86/fiTFPbh/VR981MIjz5xIRaSxFZQmNzI5IvzORskgsHGALb7Nb51q3jPKE2D1UOrQN6N6DMbGFMFR/7vRgkvUbeC0jAWevVrssEK77d5OmgXqk7sevYDwP1WnmBwr2ov/Tt+AM58BTgdHsnWRw6hL1mS9+DzCaCuDb/+vspiZnVjP9S9ckmCLP8yrwzL8Myj5lS62Rta727GulSUet21euQl0E2CuDpSoiKuO3NkYWqskfCowb0GiiX0oZe98mFiBFo1Za5Tb207fPOQyGAwY29k0/XaYxwMPsU7/hwI5Ba8iek1A09Et3HB0q0hXeKyWl425ZrMdVoOMnVyquBNo/FhAOvoSGUyiIUSDdpSwgpiJAH5cVX3W6lOy93mNtPBMk0qxtItYD3b9N7Lut6SCLhL/IGoNmrouOUX3xM8KD8qgnXmUXF0996YK9WxFfZ8HScFVno8kRZdDY4QinqcwZy+FNXBG",
    "serverRandom": "+wVP2U/SMKVkVrggDjNTXFV/",
    "userChallenge": "TLSjYRH2oYw8tW2bq0it0IUb7WIFkCLgF8NTc7-4Zq4",
    "flowType": "Notification",
    "signatureAlgorithm": "rsassa-pss",
    "signatureAlgorithmParameters": {
      "hashAlgorithm": "SHA-512",
      "maskGenAlgorithm": {
        "algorithm": "id-mgf1",
        "parameters": {
          "hashAlgorithm": "SHA-512"
        }
      },
      "saltLength": 64,
      "trailerField": "0xbc"
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acsp_v2_digest_calculation"><a class="anchor" href="#acsp_v2_digest_calculation"></a><code>ACSP_V2</code> digest calculation</h3>
<div class="paragraph">
<p>To verify the <code>signature.value</code> the RP must first reconstruct its input digest (hash). The digest is calculated over the <code>ACSP_V2_payload</code>, and <code>ACSP_V2_payload</code> is assembled using vertical bar character <code>|</code> (U+007C) as a separator.</p>
</div>
<div class="paragraph">
<p>Rules of generating the <code>digest</code> value:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in case <code>initialCallbackUrl</code> does not exist (for QR and Notification flows), this field <strong>must be empty</strong> and the separator must still be used, i.e. <code>||</code>;</p>
</li>
<li>
<p>in case the RP is not acting as a broker, the <code>brokeredRpName</code> <strong>must be empty</strong> and the separator must still be used, i.e. <code>||</code>;</p>
</li>
<li>
<p><code>interactions</code> must be the same Base64-encoded byte string value that was used to initiate the session. Since JSON to Base64 encoding is non-deterministic (parameters may be ordered randomly, whitespace can be optional), trying to encode the same object again might return a different value;</p>
</li>
<li>
<p>the digest must be calculated from <code>UTF-8</code> encoded byte array that consists of the described elements joined in the <strong>specified order</strong> with vertical bar character <code>|</code> (U+007C) as a separator, this also applies to Base64 encoded values, they must be used as is without Base64 decoding;</p>
</li>
<li>
<p>Base64 encoding <strong>must</strong> also make sure that the unused bits are set to <code>0</code> and that the resulting values are correctly padded with <code>=</code> signs;</p>
</li>
<li>
<p>the hash algorithm to use is specified in <code>signature.signatureAlgorithmParameters.hashAlgorithm</code>. The signature scheme that was used to generate the signature based on the digest is specified in <code>signature.signatureAlgorithm</code>.</p>
</li>
</ul>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">message := STR-CONCAT(
        'smart-id', '|',
        'ACSP_V2', '|',
        serverRandom, '|',
        rpChallenge, '|',
        userChallenge, '|',
        BASE64-ENCODE(relyingPartyName), '|',
        BASE64-ENCODE(brokeredRpName), '|',
        BASE64-ENCODE(SHA-256(interactions)), '|',
        interactionTypeUsed, '|',
        initialCallbackUrl, '|',
        flowType)

digest := HASH(UTF8-ENCODE(message))</code></pre>
</div>
</div>
<div id="_tabs_2" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_java" class="tab">
<p>Java</p>
</li>
<li id="_tabs_2_php" class="tab">
<p>PHP</p>
</li>
<li id="_tabs_2_python" class="tab">
<p>Python</p>
</li>
<li id="_tabs_2_go" class="tab">
<p>Go</p>
</li>
<li id="_tabs_2_rust" class="tab">
<p>Rust</p>
</li>
<li id="_tabs_2_kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="_tabs_2_c" class="tab">
<p>C#</p>
</li>
<li id="_tabs_2_node_js" class="tab">
<p>Node.js</p>
</li>
<li id="_tabs_2_ruby" class="tab">
<p>Ruby</p>
</li>
</ul>
</div>
<div id="_tabs_2_java--panel" class="tabpanel" aria-labelledby="_tabs_2_java">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.nio.charset.StandardCharsets;
import java.security.MessageDigest;
import java.util.Base64;

public class AcspV2DigestCalculator {

  public static void main(String[] args) throws Exception {
    String separator = "|";
    String schemeName = "smart-id";
    String signatureProtocol = "ACSP_V2";
    String serverRandom = "MTlop6EXCrQ6FOErcKjxUhbV";
    String rpChallenge = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==";
    String userChallenge = "GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00";
    String relyingPartyNameBase64 = "REVNTw==";
    String brokeredRpNameBase64 = "RXhhbXBsZSBSUA==";
    String interactions = "W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d";
    String interactionTypeUsed = "confirmationMessage";
    String initialCallbackUrl = "https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ";
    String flowType = "Web2App";

    MessageDigest md256 = MessageDigest.getInstance("SHA-256");
    md256.update(interactions.getBytes(StandardCharsets.UTF_8));
    byte[] interactionsHash = md256.digest();
    String interactionsBase64 = Base64.getEncoder().encodeToString(interactionsHash);

    String[] payloadParts = {
      schemeName,
      signatureProtocol,
      serverRandom,
      rpChallenge,
      userChallenge,
      relyingPartyNameBase64,
      brokeredRpNameBase64,
      interactionsBase64,
      interactionTypeUsed,
      initialCallbackUrl,
      flowType
    };

    byte[] acspV2Payload = String
      .join(separator, payloadParts)
      .getBytes(StandardCharsets.UTF_8);

    MessageDigest md512 = MessageDigest.getInstance("SHA-512");
    md512.update(acspV2Payload);
    byte[] digest = md512.digest();

    System.out.println(Base64.getEncoder().encodeToString(digest));
  }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_php--panel" class="tabpanel" aria-labelledby="_tabs_2_php">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">&lt;?php

$separator = '|';
$hashAlgorithm = 'sha512';

$schemeName = 'smart-id';
$signatureProtocol = 'ACSP_V2';
$serverRandom = 'MTlop6EXCrQ6FOErcKjxUhbV';
$rpChallenge = 'GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==';
$userChallenge = 'GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00';
$relyingPartyNameBase64 = 'REVNTw==';
$brokeredRpNameBase64 = 'RXhhbXBsZSBSUA==';
$interactions = 'W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d';
$interactionTypeUsed = 'confirmationMessage';
$initialCallbackUrl = 'https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ';
$flowType = 'Web2App';

$interactionsHash = hash('sha256', $interactions, true);
$interactionsBase64 = base64_encode($interactionsHash);

$acspV2Payload = implode($separator, [
    $schemeName,
    $signatureProtocol,
    $serverRandom,
    $rpChallenge,
    $userChallenge,
    $relyingPartyNameBase64,
    $brokeredRpNameBase64,
    $interactionsBase64,
    $interactionTypeUsed,
    $initialCallbackUrl,
    $flowType
]);

$digest = hash($hashAlgorithm, $acspV2Payload, true);
echo base64_encode($digest);

?&gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_python--panel" class="tabpanel" aria-labelledby="_tabs_2_python">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import base64
import hashlib

separator = '|'

scheme_name = 'smart-id'
signature_protocol = 'ACSP_V2'
server_random = 'MTlop6EXCrQ6FOErcKjxUhbV'
rp_challenge = 'GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg=='
user_challenge = 'GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00'
relying_party_name_base64 = 'REVNTw=='
brokered_rp_name_base64 = 'RXhhbXBsZSBSUA=='
interactions = 'W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d'
interaction_type_used = 'confirmationMessage'
initial_callback_url = 'https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ'
flow_type = 'Web2App'

interactions_hash = hashlib.sha256(interactions.encode('utf-8')).digest()
interactions_base64 = base64.b64encode(interactions_hash).decode('utf-8')

acsp_v2_payload = separator.join([
    scheme_name,
    signature_protocol,
    server_random,
    rp_challenge,
    user_challenge,
    relying_party_name_base64,
    brokered_rp_name_base64,
    interactions_base64,
    interaction_type_used,
    initial_callback_url,
    flow_type
]).encode('utf-8')

digest = hashlib.sha512(acsp_v2_payload).digest()
print(base64.b64encode(digest))</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_go--panel" class="tabpanel" aria-labelledby="_tabs_2_go">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">package main

import (
	"bytes"
	"crypto/sha512"
	"encoding/base64"
	"fmt"
)

func main() {
	var separator string = "|"

	var schemeName string = "smart-id"
	var signatureProtocol string = "ACSP_V2"
	var serverRandom string = "MTlop6EXCrQ6FOErcKjxUhbV"
	var rpChallenge string = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg=="
	var userChallenge string = "GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00"
	var relyingPartyNameBase64 string = "REVNTw=="
	var brokeredRpNameBase64 string = "RXhhbXBsZSBSUA=="
	var interactions string = "W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d"
	var interactionTypeUsed string = "confirmationMessage"
	var initialCallbackUrl string = "https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ"
	var flowType string = "Web2App"

    var interactionsHash [32]byte = sha256.Sum256([]byte(interactions))
    var interactionsBase64 string = base64.StdEncoding.EncodeToString(interactionsHash[:])

	var acspv2Payload string = strings.Join([]string{
		schemeName,
		signatureProtocol,
		serverRandom,
		rpChallenge,
		userChallenge,
		relyingPartyNameBase64,
		brokeredRpNameBase64,
		interactionsBase64,
		interactionTypeUsed,
		initialCallbackUrl,
		flowType,
	}, separator)

	var digest [64]byte = sha512.Sum512([]byte(acspv2Payload))
	fmt.Printf("%q\n", base64.StdEncoding.EncodeToString(digest[:]))
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_rust--panel" class="tabpanel" aria-labelledby="_tabs_2_rust">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use base64::Engine as _;
use sha2::{Sha256, Sha512, Digest};

fn main() {
    let separator: &amp;str = "|";

    let scheme_name: &amp;str = "smart-id";
    let signature_protocol: &amp;str = "ACSP_V2";
    let server_random: &amp;str = "MTlop6EXCrQ6FOErcKjxUhbV";
    let rp_challenge: &amp;str = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==";
    let user_challenge: &amp;str = "GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00";
    let relying_party_name_base64: &amp;str = "REVNTw==";
    let brokered_rp_name_base64: &amp;str = "RXhhbXBsZSBSUA==";
    let interactions: &amp;str = "W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d";
    let interaction_type_used: &amp;str = "confirmationMessage";
    let initial_callback_url: &amp;str = "https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ";
    let flow_type: &amp;str = "Web2App";

    let interactions_hash = Sha256::digest(interactions.as_bytes());
    let interactions_base64 = &amp;base64::engine::general_purpose::STANDARD.encode(interactions_hash);

    let acsp_v2_payload_parts: [&str; 10] = [
        scheme_name,
        signature_protocol,
        server_random,
        rp_challenge,
        user_challenge,
        relying_party_name_base64,
        brokered_rp_name_base64,
        interactions_base64,
        interaction_type_used,
        initial_callback_url,
        flow_type
    ];

    let acsp_v2_payload: String = acsp_v2_payload_parts.join(separator);

    let mut hasher = Sha512::new();
    hasher.update(acsp_v2_payload.as_bytes());
    let digest: Vec&lt;u8&gt; = hasher.finalize().to_vec();
    println!("{:?}", base64::engine::general_purpose::STANDARD.encode(digest))
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_kotlin--panel" class="tabpanel" aria-labelledby="_tabs_2_kotlin">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import java.nio.charset.StandardCharsets
import java.security.MessageDigest
import java.util.Base64

fun main() {
    val separator: String = "|"

    val schemeName: String = "smart-id"
    val signatureProtocol: String = "ACSP_V2"
    val serverRandom: String = "MTlop6EXCrQ6FOErcKjxUhbV"
    val rpChallenge: String = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg=="
    val userChallenge: String = "GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00"
    val relyingPartyNameBase64: String = "REVNTw=="
    val brokeredRpNameBase64: String = "RXhhbXBsZSBSUA=="
    val interactions: String = "W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d"
    val interactionTypeUsed: String = "confirmationMessage"
    val initialCallbackUrl: String = "https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ"
    val flowType: String = "Web2App"

    val interactionsHash: ByteArray = MessageDigest
        .getInstance("SHA-256")
        .digest(interactions.toByteArray(StandardCharsets.UTF_8))

    val interactionsBase64: String = Base64
        .getEncoder()
        .encodeToString(interactionsHash)

    val acspV2Payload: ByteArray = listOf(
        schemeName,
        signatureProtocol,
        serverRandom,
        rpChallenge,
        userChallenge,
        relyingPartyNameBase64,
        brokeredRpNameBase64,
        interactionsBase64,
        interactionTypeUsed,
        initialCallbackUrl,
        flowType
    )
        .joinToString(separator)
        .toByteArray(StandardCharsets.UTF_8)

    val acspV2Digest: ByteArray = MessageDigest
        .getInstance("SHA-512")
        .digest(acspV2Payload)

    println(Base64.getEncoder().encodeToString(acspV2Digest))
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_c--panel" class="tabpanel" aria-labelledby="_tabs_2_c">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cs hljs" data-lang="cs">using System;
using System.Security.Cryptography;
using System.Text;

public class AcspV2DigestCalculator
{
    public static void Main(string[] args)
    {
        string separator = "|";

        string schemeName = "smart-id";
        string signatureProtocol = "ACSP_V2";
        string serverRandom = "MTlop6EXCrQ6FOErcKjxUhbV";
        string rpChallenge = "GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==";
        string userChallenge = "GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00";
        string relyingPartyNameBase64 = "REVNTw==";
        string brokeredRpNameBase64 = "RXhhbXBsZSBSUA==";
        string interactions = "W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d";
        string interactionTypeUsed = "confirmationMessage";
        string initialCallbackUrl = "https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ";
        string flowType = "Web2App";

        byte[] interactionsHash = SHA256.Create().ComputeHash(Encoding.UTF8.GetBytes(interactions));
        string interactionsBase64 = Convert.ToBase64String(interactionsHash);

        string[] payloadParts = {
            schemeName,
            signatureProtocol,
            serverRandom,
            rpChallenge,
            userChallenge,
            relyingPartyNameBase64,
            brokeredRpNameBase64,
            interactionsBase64,
            interactionTypeUsed,
            initialCallbackUrl,
            flowType
        };

        byte[] acspV2Payload = Encoding.UTF8.GetBytes(
            string.Join(separator, payloadParts)
        );

        byte[] digest = SHA512.Create().ComputeHash(acspV2Payload);
        string base64Digest = Convert.ToBase64String(digest);
        Console.WriteLine(base64Digest);
    }
}</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_node_js--panel" class="tabpanel" aria-labelledby="_tabs_2_node_js">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const crypto = require('crypto');

const separator = '|';

const schemeName = 'smart-id';
const signatureProtocol = 'ACSP_V2';
const serverRandom = 'MTlop6EXCrQ6FOErcKjxUhbV';
const rpChallenge = 'GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg==';
const userChallenge = 'GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00';
const relyingPartyNameBase64 = 'REVNTw==';
const brokeredRpNameBase64 = 'RXhhbXBsZSBSUA==';
const interactions = 'W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d';
const interactionTypeUsed = 'confirmationMessage';
const initialCallbackUrl = 'https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ';
const flowType = 'Web2App';

const interactionsBase64 = crypto.createHash('sha256').update(interactions).digest('base64');

const acspV2Payload = [
    schemeName,
    signatureProtocol,
    serverRandom,
    rpChallenge,
    userChallenge,
    relyingPartyNameBase64,
    brokeredRpNameBase64,
    interactionsBase64,
    interactionTypeUsed,
    initialCallbackUrl,
    flowType
].join(separator);

const digest = crypto.createHash('sha512').update(acspV2Payload).digest('base64');
console.log(digest);</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_ruby--panel" class="tabpanel" aria-labelledby="_tabs_2_ruby">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ruby hljs" data-lang="ruby">require 'base64'
require 'digest'

separator = '|'

scheme_name = 'smart-id'
signature_protocol = 'ACSP_V2'
server_random = 'MTlop6EXCrQ6FOErcKjxUhbV'
rp_challenge = 'GYS+yoah6emAcVDNIajwSs6UB/M95XrDxMzXBUkwQJ9YFDipXXzGpPc7raWcuc2+TEoRc7WvIZ/7dU/iRXenYg=='
user_challenge = 'GnsWXXEjTCKR89fj9uo5u5ReBZ9JR7_pezLAI5jMS00'
relying_party_name_base64 = 'REVNTw=='
brokered_rp_name_base64 = 'RXhhbXBsZSBSUA=='
interactions = 'W3sidHlwZSI6ImNvbmZpcm1hdGlvbk1lc3NhZ2UiLCJkaXNwbGF5VGV4dDIwMCI6IkxvbmdlciBkZXNjcmlwdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dCJ9LHsidHlwZSI6ImRpc3BsYXlUZXh0QW5kUElOIiwiZGlzcGxheVRleHQ2MCI6IlNob3J0IGRlc2NyaXB0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbiBjb250ZXh0In1d'
interaction_type_used = 'confirmationMessage'
initial_callback_url = 'https://rp.example.com/callback-url?value=RrKjjT4aggzu27YBddX1bQ'
flow_type = 'Web2App'

interactions_hash = Digest::SHA256.digest(interactions)
interactions_base64 = Base64.strict_encode64(interactions_hash)

acsp_v2_payload = [
    scheme_name,
    signature_protocol,
    server_random,
    rp_challenge,
    user_challenge,
    relying_party_name_base64,
    brokered_rp_name_base64,
    interactions_base64,
    interaction_type_used,
    initial_callback_url,
    flow_type
].join(separator)

digest = Digest::SHA512.digest(acsp_v2_payload)
puts Base64.strict_encode64(digest)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 1. <code>ACSP_V2</code> signature digest (in Base64 format)</div>
<div class="content">
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">pKOjbNl/5Fy8NfrFqsj6pSn8W8O+Ik8rM33QSsbyD3J9qDJvEm90SboUciuY4wHGWa0Pnq8BgT3NJKmJiUDfKg==</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Full verification of the signature and response is described in <a href="response_verification.html" class="xref page">Response verification</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="raw_digest_signature_protocol"><a class="anchor" href="#raw_digest_signature_protocol"></a><code>RAW_DIGEST_SIGNATURE</code> signature protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>RAW_DIGEST_SIGNATURE</code> is a signature protocol where a pre-calculated digest (hash) of the data-to-be-signed is sent in the initial request, and the digital signature is generated directly on this provided digest. For verification, the digest itself or the complete original data that corresponds to the digest must be used.</p>
</div>
<div class="sect2">
<h3 id="raw_digest_signature_request_parameters"><a class="anchor" href="#raw_digest_signature_request_parameters"></a><code>RAW_DIGEST_SIGNATURE</code> signature request parameters</h3>
<div class="paragraph">
<p>For <code>RAW_DIGEST_SIGNATURE</code> <code>signatureProtocol</code> and <code>signatureProtocolParameters</code> parameters in the signature requests and examples, see the <a href="api_specification.html" class="xref page">API spec signature request parameters</a>.</p>
</div>
<div class="sect3">
<h4 id="raw_digest_signature_digest_calculation"><a class="anchor" href="#raw_digest_signature_digest_calculation"></a><code>RAW_DIGEST_SIGNATURE</code> digest value</h4>
<div class="paragraph">
<p>The <code>digest</code> value sent with the initial RP request is the digest value of the data-to-be-signed. One of the supported hash algorithms must be used. The signature is directly generated on the <code>digest</code> value and the verification must be done using the data-to-be-signed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_raw_digest_signature_signature_response_parameters"><a class="anchor" href="#_raw_digest_signature_signature_response_parameters"></a><code>RAW_DIGEST_SIGNATURE</code> signature response parameters</h3>
<div class="paragraph">
<p>For <code>RAW_DIGEST_SIGNATURE</code> <code>signature</code> parameter in the signature response and examples, see the <a href="api_specification.html" class="xref page">API spec session status response parameters</a>.</p>
</div>
<div class="paragraph">
<p>Full verification of the signature and response is described in <a href="response_verification.html" class="xref page">Response verification</a>.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>© 2024 SK ID Solutions AS</p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script async src="../_/js/vendor/tabs.js" data-sync-storage-key="language"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async src="../search-index.js"></script>
  </body>
</html>
